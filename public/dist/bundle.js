var tsActionTimer;(()=>{var e={650:function(e,t){!function(e){"use strict";var t,r=void 0===Number.MAX_SAFE_INTEGER?9007199254740991:Number.MAX_SAFE_INTEGER,n=536870912,i=1073741824,o=new WeakMap,a=function(e,t){return function(o){var a=t.get(o),s=void 0===a?o.size:a<i?a+1:0;if(!o.has(s))return e(o,s);if(o.size<n){for(;o.has(s);)s=Math.floor(Math.random()*i);return e(o,s)}if(o.size>r)throw new Error("Congratulations, you created a collection of unique numbers which uses all available integers!");for(;o.has(s);)s=Math.floor(Math.random()*r);return e(o,s)}}((t=o,function(e,r){return t.set(e,r),r}),o),s=function(e){return function(t){var r=e(t);return t.add(r),r}}(a);e.addUniqueNumber=s,e.generateUniqueNumber=a,Object.defineProperty(e,"__esModule",{value:!0})}(t)},698:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=r(355);class i{constructor(){}static getMsFromString(e){const t=e.match(/\d+/g);return 60*Number(t[0])*60*1e3+60*Number(t[1])*1e3+1e3*Number(t[2])}static getMsFormated(e){var t=Math.floor(e/60/60/1e3),r=Math.floor((e-60*t*60*1e3)/60/1e3),n=Math.floor((e-60*t*60*1e3-60*r*1e3)/1e3);return`(${Math.floor(t)}:${Math.floor(r)}:${Math.floor(n)})`}static updateTimeDOM(e,t,r,o){const a=i.now().getTime(),s=e.getTime()-a,l=n.setInterval((function(){const m=new Date,d=/\(.*\)/;s-(m.getTime()-a)>0?t.value=r.replace(d,"")+" "+i.getMsFormated(s-(m.getTime()-a)):t.value=r.replace(d,"")+" "+i.getMsFormated(0),s-(m.getTime()-a)<=0&&(console.log("Action timed [date]: "+i.toString(e)+":"+e.getMilliseconds()),console.log("Action executed [date]: "+i.toString(m)+":"+m.getMilliseconds()),t.value=r.replace(d,""),n.clearInterval(l),o&&o.click())}),1);return l}static generateDateFromString(e){const t=e.match(/\d+/g),r=Number(t[0]),n=Number(t[1])-1,i=Number(t[2]),o=Number(t[3]),a=Number(t[4]),s=Number(t[5]),l=Number(t[6])?Number(t[6]):0;return new Date(new Date(i,n,r,o,a,s).setMilliseconds(l))}}t.default=i,i.now=()=>new Date(new Date(Date.now()).setMilliseconds(0)),i.correctTimeOffset=e=>{const t=60*i.now().getTimezoneOffset()*1e3;return new Date(e.getTime()-t)},i.toString=e=>{const t=/^.*\s/g,r=/\s.*$/g,n=e?e.toLocaleString().match(t):i.now().toLocaleString().match(t),o=e?e.toLocaleString().match(r):i.now().toLocaleString().match(r),[a,s,l]=n[0].trim().split("."),[m,d,c]=o[0].trim().split(":");return`${a}.${s}.${l} ${m}:${d}:${c}`}},355:(e,t,r)=>{"use strict";r.r(t),r.d(t,{clearInterval:()=>a,clearTimeout:()=>s,setInterval:()=>l,setTimeout:()=>m});var n=r(650);let i=null;const o=()=>{if(null!==i)return i;const e=new Blob(['(()=>{"use strict";const e=new Map,t=new Map,r=(e,t)=>{let r,o;const i=performance.now();r=i,o=e-Math.max(0,i-t);return{expected:r+o,remainingDelay:o}},o=(e,t,r,i)=>{const s=performance.now();s>r?postMessage({id:null,method:"call",params:{timerId:t,timerType:i}}):e.set(t,setTimeout(o,r-s,e,t,r,i))};addEventListener("message",(i=>{let{data:s}=i;try{if("clear"===s.method){const{id:r,params:{timerId:o,timerType:i}}=s;if("interval"===i)(t=>{const r=e.get(t);if(void 0===r)throw new Error(\'There is no interval scheduled with the given id "\'.concat(t,\'".\'));clearTimeout(r),e.delete(t)})(o),postMessage({error:null,id:r});else{if("timeout"!==i)throw new Error(\'The given type "\'.concat(i,\'" is not supported\'));(e=>{const r=t.get(e);if(void 0===r)throw new Error(\'There is no timeout scheduled with the given id "\'.concat(e,\'".\'));clearTimeout(r),t.delete(e)})(o),postMessage({error:null,id:r})}}else{if("set"!==s.method)throw new Error(\'The given method "\'.concat(s.method,\'" is not supported\'));{const{params:{delay:i,now:n,timerId:a,timerType:d}}=s;if("interval"===d)((t,i,s)=>{const{expected:n,remainingDelay:a}=r(t,s);e.set(i,setTimeout(o,a,e,i,n,"interval"))})(i,a,n);else{if("timeout"!==d)throw new Error(\'The given type "\'.concat(d,\'" is not supported\'));((e,i,s)=>{const{expected:n,remainingDelay:a}=r(e,s);t.set(i,setTimeout(o,a,t,i,n,"timeout"))})(i,a,n)}}}}catch(e){postMessage({error:{message:e.message},id:s.id,result:null})}}))})();'],{type:"application/javascript; charset=utf-8"}),t=URL.createObjectURL(e);return i=(e=>{const t=new Map([[0,()=>{}]]),r=new Map([[0,()=>{}]]),i=new Map,o=new Worker(e);return o.addEventListener("message",(({data:e})=>{if(void 0!==(n=e).method&&"call"===n.method){const{params:{timerId:n,timerType:o}}=e;if("interval"===o){const e=t.get(n);if("number"==typeof e){const t=i.get(e);if(void 0===t||t.timerId!==n||t.timerType!==o)throw new Error("The timer is in an undefined state.")}else{if(void 0===e)throw new Error("The timer is in an undefined state.");e()}}else if("timeout"===o){const e=r.get(n);if("number"==typeof e){const t=i.get(e);if(void 0===t||t.timerId!==n||t.timerType!==o)throw new Error("The timer is in an undefined state.")}else{if(void 0===e)throw new Error("The timer is in an undefined state.");e(),r.delete(n)}}}else{if(!(e=>null===e.error&&"number"==typeof e.id)(e)){const{error:{message:t}}=e;throw new Error(t)}{const{id:n}=e,o=i.get(n);if(void 0===o)throw new Error("The timer is in an undefined state.");const{timerId:a,timerType:s}=o;i.delete(n),"interval"===s?t.delete(a):r.delete(a)}}var n})),{clearInterval:e=>{const r=(0,n.generateUniqueNumber)(i);i.set(r,{timerId:e,timerType:"interval"}),t.set(e,r),o.postMessage({id:r,method:"clear",params:{timerId:e,timerType:"interval"}})},clearTimeout:e=>{const t=(0,n.generateUniqueNumber)(i);i.set(t,{timerId:e,timerType:"timeout"}),r.set(e,t),o.postMessage({id:t,method:"clear",params:{timerId:e,timerType:"timeout"}})},setInterval:(e,r)=>{const i=(0,n.generateUniqueNumber)(t);return t.set(i,(()=>{e(),"function"==typeof t.get(i)&&o.postMessage({id:null,method:"set",params:{delay:r,now:performance.now(),timerId:i,timerType:"interval"}})})),o.postMessage({id:null,method:"set",params:{delay:r,now:performance.now(),timerId:i,timerType:"interval"}}),i},setTimeout:(e,t)=>{const i=(0,n.generateUniqueNumber)(r);return r.set(i,e),o.postMessage({id:null,method:"set",params:{delay:t,now:performance.now(),timerId:i,timerType:"timeout"}}),i}}})(t),i.setTimeout((()=>URL.revokeObjectURL(t)),0),i},a=e=>o().clearInterval(e),s=e=>o().clearTimeout(e),l=(e,t)=>o().setInterval(e,t),m=(e,t)=>o().setTimeout(e,t)}},t={};function r(n){var i=t[n];if(void 0!==i)return i.exports;var o=t[n]={exports:{}};return e[n].call(o.exports,o,o.exports,r),o.exports}r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var n={};(()=>{"use strict";var e=n;const t=r(698),i=r(355);e.default=class{constructor(){this.execution=()=>{this.timedId&&i.clearInterval(this.timedId);const e=this._container.getElementsByTagName("tbody")[0],r=(e.getElementsByTagName("tr"),document.evaluate("//td[text()='Dauer:']",e,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue.nextSibling.textContent),n=this._container.getElementsByClassName("timedAction")[0].value,o=this._container.getElementsByClassName("troop_confirm_go")[0],a=new Date(t.default.generateDateFromString(n).getTime()-t.default.getMsFromString(r)),s=this._container.getElementsByClassName("troop_confirm_go")[0];if(t.default.now().getTime()>t.default.generateDateFromString(n).getTime()-t.default.getMsFromString(r))return alert("Time for attack is already passed!"),void(this.timedId&&i.clearInterval(this.timedId));this.timedId=t.default.updateTimeDOM(a,o,o.value,s)};const e=document.getElementById("popup_box_popup_command");!e||e.classList.contains("initialized")?e.classList.contains("initialized")?alert("already initialized!"):alert("Please run on attacking/supporting popup"):(console.log("tsActionTimer initialized"),e.classList.add("initialized"),this._container=e)}static init(e){const r=e._container,n=r.getElementsByTagName("tbody")[0],i=n.getElementsByTagName("tr");if(!r||!n||!i)return;if(console.log(`===== Start Initialization: ${t.default.now()} =====`),r.getElementsByTagName("button").length>0)return console.error("tsAttackTimer already running, please refresh and rerun script!");const o=document.createElement("tr");o.classList.add("timed");const a=new Date(t.default.now().getTime()+36e5);o.innerHTML=`\n     <td>Timed:</td>\n     <td id="date_arrival">\n      <input type="text" class="timedAction" value="${a.getDate()}.${a.getMonth()+1}.${a.getFullYear()} ${a.getUTCHours()}:${a.getMinutes()}:${a.getSeconds()}:${a.getMilliseconds()}" />\n      <button type="button" class="btn setTimedAction">Set Timing</button>\n     </td>\n    `,n.appendChild(o),n.getElementsByClassName("setTimedAction")[0].onclick=function(t){t.preventDefault(),e.execution(),e.requestTime()}}requestTime(){let e=t.default.now().getTime();fetch("/game.php?",{method:"HEAD",mode:"cors",credentials:"include"}).finally((()=>{const t=document.createElement("td");t.innerHTML=`(${(new Date).getTime()-e} ms delay)`,this._container.getElementsByClassName("timed")[0].appendChild(t),console.log("Request took "+((new Date).getTime()-e)+"ms")}))}}})(),tsActionTimer=n.default})();